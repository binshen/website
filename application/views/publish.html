<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>房猫</title>
<meta name="keywords" content="房猫,昆山" />
<meta name="description" content="" />
<link href="{{$base_url}}css/publish.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="{{$base_url}}js/jquery-1.8.3.min.js" ></script>
<!-- <script type="text/javascript" src="{{$base_url}}js/validform.js" ></script> -->

<script src="{{$base_url}}dwz/xheditor/xheditor-1.2.1.min.js" type="text/javascript"></script>
<script src="{{$base_url}}dwz/xheditor/xheditor_lang/zh-cn.js" type="text/javascript"></script>

<link href="{{$base_url}}js/jquery-ui/jquery-ui.min.css" rel="stylesheet">
<script src="{{$base_url}}js/jquery-ui/jquery-ui.min.js"></script>

<!--plupload start--------------------------------------------------------------------------->
<!-- Load plupload and all it's runtimes and finally the UI widget -->
<link rel="stylesheet" href="{{$base_url}}plupload/js/jquery.ui.plupload/css/jquery.ui.plupload.css" type="text/css" />
<!-- production -->
<script type="text/javascript" src="{{$base_url}}plupload/js/plupload.full.min.js"></script>
<script type="text/javascript" src="{{$base_url}}plupload/js/zh_CN.js"></script>
<script type="text/javascript" src="{{$base_url}}plupload/js/jquery.ui.plupload/jquery.ui.plupload.js"></script>
<!--plupload end---------------------------------------------------------------------------->

<!--  
<link href="{{$base_url}}js/easydialog/easydialog.css" rel="stylesheet">
<script src="{{$base_url}}js/easydialog/easydialog.min.js"></script>
-->

<link href="{{$base_url}}js/layer/skin/layer.css" rel="stylesheet">
<script src="{{$base_url}}js/layer/layer.js"></script>

</head>
<body>
<div class="wraper">
   	{include file="header.html"}
    <!--------------头部导航start---------------->
	{include file="header_login.html"}
    <!--------------头部导航end---------------->
    <!--------------房源发布start-------------->
    <div class="publishtit">
        <span class="fz34">免费发布房源</span><br />房猫值得你信赖，房猫帮你快速找到精准客户。
    </div>
    <div class="publishconer">
    <form method="POST" action="/house/save_publish" id="publishForm">
    	<input type="hidden" name="type_id" id="type_id" value="2" />
    	<input type="hidden" name="rent_style_id" id="rent_style_id" value="" />
    	<input type="hidden" name="style_id" id="style_id" value="" />
    	<input type="hidden" name="substyle_id" id="substyle_id" value="" />
    	<input type="hidden" name="region_id" id="region_id" value="" />
    	<input type="hidden" name="decoration_id" id="decoration_id" value="1" />
    	<input type="hidden" name="orientation_id" id="orientation_id" value="" />
    	<input type="hidden" name="rent_type_id" id="rent_type_id" value="" />
    	<input type="hidden" name="room" id="room" value="" />
    	<input type="hidden" name="lounge" id="lounge" value="" />
    	<input type="hidden" name="toilet" id="toilet" value="" />
    	
        <table cellpadding="0" cellspacing="0" border="0" class="publishtab">
            <tr class="fi-style">
                <th width="200"><em class="red">*</em> 选择发布类型</th>
                <td>
                	<a href="javascript:void(0)" class="_house_style style selected" key="1">二手房<i class="icon ico-selected"></i></a>
                	<a href="javascript:void(0)" class="_house_style style" key="2">整组<i class="icon ico-selected"></i></a>
                	<a href="javascript:void(0)" class="_house_style style" key="3">合租<i class="icon ico-selected"></i></a>
				</td>
            </tr>
            <tr class="fi-style">
                <th><em class="red">*</em> 小区名称</th>
                <td>
                	<!--
                	<div class="input_position" style="z-index:10;">
                        <input name="input_projname" type="text" id="input_projname" autocomplete="off" size="30" maxlength="30" class="txt" style="width: 300px;" value="" placeholder="请填写小区名称" /><span class="sp_ok"></span><span id="sp_projname" class="tip_ok">如：香榭水岸 或 xxsa</span>
                        <span id="sp_projname_error" class="tip_error">请填写小区名称，并在下拉框中选择小区</span>
                        <div class='showselectcon' id='selhouse_style3' style='position: absolute;
                            top: 37px; left: 0;display:none;'>
                            <a href="javascript:">独栋别墅</a>
                            <a href="javascript:">联排别墅</a>
                            <a href="javascript:">双拼别墅</a>
                            <a href="javascript:">叠加别墅</a>
                        </div>
                     </div>
                     -->
                     <select name="xq_id" id="xiaoquSelect" style="padding-left:5px;">
						<option value="">- 选择 -</option>
						{{foreach from=$xiaoqu_list item=item}}
							<option value="{{$item.id}}">{{$item.name}}</option>
						{{/foreach}}
					</select>
					<span style="padding-left:40px;color:#999">请填写小区名称，并在下拉框中选择小区</span>
				</td>
            </tr>
            <tr class="fi-style">
                <th><em class="red">*</em> 房源类型</th>
                <td>
	                <div class="simu-select-box" >
	                    <div class="select_position" id="selDistrict" style="z-index:99; float:left;">
	                        <span id="selDistrict_a"  class="selectbg" style="cursor: pointer;">请选择类型</span>
	                        <div class='showselectcon' id='selhouse_style1' style='position: absolute; top: 37px; left: 0; display:none; z-index:999'>
	                         	{{foreach from=$style_list item=item}}
	                         		<a href="javascript:" key="style_id" val="{{$item->id}}">{{$item->name}}</a>
	                         	{{/foreach}}
	                        </div>
	                    </div>
	                </div>
	                <div class="simu-select-box">
	                    <div class="select_position" id="selComarea" style="z-index:99; float:left;">
	                        <span id="selDistrict_a"  class="selectbg" style="cursor: pointer;">请选择类型</span>
	                        <div class='showselectcon' id='selhouse_style2' style='position: absolute;
	                            top: 37px; left: 0;display:none;'>
	                           	{{foreach from=$substyle_list item=item}}
	                         		<a href="javascript:" key="substyle_id" val="{{$item.id}}">{{$item.name}}</a>
	                         	{{/foreach}}
	                        </div>
	                    </div>
	                </div>
                 </td>
            </tr>
            
            <tr class="fi-style">
                <th><em class="red">*</em> 所在区域</th>
                <td>
                <div class="select_position" id="selComarea">
                        <span id="selDistrict_a" class="selectbg" style="cursor: pointer;">
                        	请选择区域</span>
                        <div class='showselectcon' id='selhouse_style4' style='position: absolute; top: 37px; left: 0; display:none; z-index:999'>
                            {{foreach from=$region_list item=item}}
                         		<a href="javascript:" key="region_id" val="{{$item->id}}">{{$item->name}}</a>
                         	{{/foreach}}
                        </div>
                    </div>
                </td>
            </tr>
            <!--  
            <tr class="fi-style">
                <th>楼栋号</th>
                <td>
  					<input name="input_floornum" type="text" id="input_floornum" autocomplete="off" size="30" maxlength="30" class="txt" style="width: 70px;" value="" />幢
                	<input name="input_roomnum" type="text" id="input_roomnum" autocomplete="off" size="30" maxlength="30" class="txt" style="width: 70px;" value="" />室
                    <span id="sp_floornum" class="tip_ok span_floornum">不对外显示，仅为估价用</span>
                </td>
            </tr>
            -->
            <tr class="fi-style">
                <th><em class="red">*</em> 户型</th>
                <td>
                	<div class="simu-select-box">
                        <div class="select_position" id="" style="z-index:11;">
                            <span id="selRoom"  class="selectbg selectbg1" style="cursor: pointer;"></span>
                            <div class='showselectcon' id='' style='position: absolute; top: 37px; left: 0;display:none;'>
	                            {{foreach from=$room_list item=item}}
	                         		<a href="javascript:" key="room" val="{{$item}}">{{$item}}</a>
	                         	{{/foreach}}
                            </div>
                        </div>室
                        <div class="select_position" id="" style="z-index:11;">
                            <span id="selLounge"  class="selectbg selectbg1" style="cursor: pointer;"></span>
                            <div class='showselectcon' id='' style='position: absolute; top: 37px; left: 0;display:none;'>
                                {{foreach from=$lounge_list item=item}}
	                         		<a href="javascript:" key="lounge" val="{{$item}}">{{$item}}</a>
	                         	{{/foreach}}
                            </div>
                        </div>厅
                        <div class="select_position" id="" style="z-index:11;">
                            <span id="selToilet"  class="selectbg selectbg1" style="cursor: pointer;"></span>
                            <div class='showselectcon' id='' style='position: absolute; top: 37px; left: 0;display:none;'>
                            	{{foreach from=$toilet_list item=item}}
	                         		<a href="javascript:" key="toilet" val="{{$item}}">{{$item}}</a>
	                         	{{/foreach}}
                            </div>
                        </div>卫
                    </div>
                </td>
            </tr>
            <tr class="fi-style">
                <th><em class="red">*</em> 所在楼层</th>
                <td>
                	<input name="floor" type="text" id="floor" autocomplete="off" size="30" maxlength="3" class="txt" style="width: 70px;" value="" />
                	<span class="td-tit" style="font-size: 13px; font-weight: bold;">总楼层</span>
                	<input name="total_floor" type="text" id="total_floor" autocomplete="off" size="30" maxlength="3" class="txt" style="width: 70px;" value="" />
                 	<span id="sp_hnownum" class="tip_ok" style="display:inline-block">(地下室请填负数)</span>
                 	<span id="sp_hnownum_error" class="tip_error">请填写所在楼层</span>
                </td>
            </tr>
            <tr class="fi-style">
                <th><em class="red">*</em> 面积</th>
                <td><input name="acreage" type="text" id="acreage" autocomplete="off" size="30" maxlength="10" class="txt" style="width: 70px;" value="" />平米
                 <span id="sp_housearea" class="tip_ok">请填写整数</span>
                </td>
            </tr>
             <tr class="fi-style">
                <th><em class="red">*</em> 建造年代</th>
                <td><input name="build_year" type="text" id="build_year" autocomplete="off" size="30" maxlength="4" class="txt" style="width: 70px;" value="" />年
                 <span class="tip_error">请填写</span>
                </td>
            </tr>
             <tr class="fi-style">
                <th><em class="red">*</em> 装修程度</th>
                <td class="decorate-degree">
                	{{foreach from=$decoration_list item=item key=key}}
                   		<span {{if $key==0}}style="padding-left:9px;"{{/if}}>
                   			<input type="radio" name="decoration" class="rblstFitment" id="decoration_{{$key}}" value="{{$item->id}}" {{if $key==0}}checked{{/if}}/>
                   			<label for="decoration_{{$key}}">{{$item->name}}</label>
                   		</span>
                   	{{/foreach}}
                </td>
            </tr>
            <tr class="fi-style">
                <th><em class="red">*</em> 朝向</th>
                <td>
               		<div class="select_position" id="selComarea">
                        <span id="selDistrict_a" class="selectbg" style="cursor: pointer;">请选择朝向</span>
                        <div class='showselectcon' id='selhouse_style4' style='position: absolute; top: 37px; left: 0; display:none;'>
                            {{foreach from=$orientation_list item=item}}
                         		<a href="javascript:" key="orientation_id" val="{{$item->id}}">{{$item->name}}</a>
                         	{{/foreach}}
                        </div>
                    </div>
                </td>
            </tr>
            <!--二手房-->
            <tr class="fi-style" id="sd_tr">
                <th><em class="red">*</em> 期望售价</th>
                <td><input name="total_price" type="text" id="total_price" autocomplete="off" size="30" maxlength="10" class="txt" style="width: 70px;" value="" />万元
                <span class="tip_error">请填写</span>
                </td>
            </tr>
            <!--整租&合租-->
            <tr class="fi-style" id="rent_tr" style="display:none">
                <th><em class="red">*</em> 期望租金</th>
                <td><input name="unit_price" type="text" id="unit_price" autocomplete="off" size="30" maxlength="10" class="txt" style="width: 70px;" value="" />元/月
                <span class="td-tit" style="font-size: 13px; font-weight: bold;">租金押付</span> <div class="select_position" id="rentAndPay" style="z-index:11;">
                        <span class="selectbg" style="cursor: pointer;">
                        	请选择</span>
                        <div class='showselectcon' style='position: absolute;
                            top: 37px; left: 0;display:none;'>
                            {{foreach from=$rent_type_list item=item}}
                         		<a href="javascript:" key="rent_type_id" val="{{$item->id}}">{{$item->name}}</a>
                         	{{/foreach}}
                        </div>
                    </div>
                <span class="tip_error">请填写</span>
                </td>
            </tr>
            <tr class="fi-style">
                <th><em class="red">*</em> 物业费</th>
                <td><input name="estate_price" type="text" id="estate_price" autocomplete="off" size="30" maxlength="10" class="txt" style="width: 70px;" value="" />元/平米/月
                <span class="tip_error">请填写</span>
                </td>
            </tr>
            <tr class="fi-style">
                <th><em class="red">*</em> 配套设施</th>
                <td><input name="facility" type="text" id="facility" autocomplete="off" size="30" maxlength="200" class="txt" style="width: 300px;" value="" />
                 <span class="tip_error">请填写</span>
                </td>
            </tr>
            <tr class="fi-style">
                <th><em class="red">*</em> 房源标题</th>
                <td><input name="name" type="text" id="name" autocomplete="off" size="30" maxlength="200" class="txt" style="width: 300px;" value="" />
                <span style="color:#999">可填写楼栋号,房号等相关信息</span>
                <span class="tip_error">请填写</span>
                </td>
            </tr>
            <tr class="fi-style">
                <th><em class="red">*</em> 房源副标题</th>
                <td><input name="sub_title" type="text" id="sub_title" autocomplete="off" size="30" maxlength="200" class="txt" style="width: 300px;" value="" />
                <span style="color:#999">可填写房源特色,推荐理由等信息</span>
                <span class="tip_error">请填写</span>
                </td>
            </tr>
            <tr class="fi-style">
                <th><em class="red">*</em> 上传图片</th>
                <td class="other">
	                <div id="uploadImgcontainer" class="clearfix">
	                	<!--
	                    <div class="w_upload">
	                        <em class="iscover"></em>
	                        <a href="javascript:void(0);" class="item-close"></a>
	                        <img src="http://dummyimage.com/100x75/000/fff" alt="" width="100" height="75" />
	                    </div>
	                    <div class="w_upload">
	                    	<a href="javascript:void(0);" class="set-cover" onclick="set_bg(this);">设为封面</a>
	                    	<a href="javascript:void(0);" class="item-close"></a>
	                        <img src="http://dummyimage.com/100x75/000/fff" alt="" width="100" height="75" />
	                    </div>
	                    -->
	                </div>
	                <span class="uploading-btn layer_notice" id="fileUpload"><em></em>批量上传</span>
	                <input type="hidden" name="folder" value="{{$time}}" id="folder">
    	    		<input type="hidden" name="is_bg" value="" id="is_bg">
               	</td>
            </tr>
            <tr class="fi-style">
                <th><em class="red">*</em> 房源描述</th>
                <td class="other">
                    <textarea id="description" name="description" rows="15" cols="100" upImgUrl="<?php echo site_url('manage/upload_pic')?>" upImgExt="jpg,jpeg,gif,png"  tools="Bold,Italic,Underline,Strikethrough,|,Align,List,|,Link,Img"></textarea>
                </td>
            </tr>
            <tr class="fi-style">
                <th><em class="red">*</em> 姓名</th>
                <td><input name="user_name" type="text" id="user_name" autocomplete="off" size="30" maxlength="30" class="txt" style="width: 100px;" value="" />
                 <span class="tip_error">请填写</span>
                 </td>
            </tr>
            <tr class="fi-style">
                <th><em class="red">*</em> 联系电话</th>
                <td><input name="user_tel" type="text" id="user_tel" autocomplete="off" size="30" maxlength="30" class="txt" style="width: 200px;" value="" />
                 <span class="tip_error">请填写</span>
                </td>
            </tr>
             <tr class="fi-style">
                <th>&nbsp;</th>
                <td><a href="javascript:void(0);" class="confirmpush-btn" id="btnSubmit">确定发布</a> </td>
            </tr>
        </table>
      </form>
    </div>
    <!--------------房源发布end-------------->
</div>
{include file="footer.html"}
<link href="{{$base_url}}css/combox.css" rel="stylesheet" type="text/css" />
<script src="{{$base_url}}js/combox.js"></script>

<script>
//模拟下拉
$('.select_position span').click(function(){
	var thisChildObject = $(this).parent().children(".showselectcon");
	thisChildObject.show();
	$(this).parent().mouseleave(function(){
		thisChildObject.hide();
	});
});

$('.select_position .showselectcon a').click(function(){
	clickOption(this);

	if($(this).attr('key') == 'style_id') {
		$.get('/house/get_substyle_list/' + $(this).attr('val'), function(data) {
			var items = JSON.parse(data);
			$("#selhouse_style2").empty();
			for(var i in items) {
				var data = items[i];
				$("#selhouse_style2").append('<a href="javascript:" key="substyle_id" val="'+data.id+'" onclick="clickOption(this);">'+data.name+'</a>');
			}
		})
	}
});

function clickOption(obj) {
	$(obj).parent().hide();
	$(obj).parent().prev('.selectbg').html($(obj).html());
	
	var key = $(obj).attr('key');
	var val = $(obj).attr('val');
	$("#" + key).val(val);
}

function uploadFile() {
	if ($('#uploader').plupload('getFiles').length < 1) {
		FM_Alert("请选择并上传房源图片");
		return false;
	} else {
		$.getJSON("/house/get_pics/" + $("#folder").val() + "/1" + "?_=" + Math.random(), function(data){
			var html = '';
			var now_pic = [];
			$('input[name="pic_short[]"]').each(function(index){
				now_pic[index] = $(this).val();
			});
			$.each(data.img,function(index,item){
				var path = "{{$base_url}}uploadfiles/pics/" + data.time + "/1/" + item;
				if($.inArray(item, now_pic) < 0){
					html+='<div class="w_upload">';
					html+='<a href="javascript:void(0);" class="set-cover" onclick="set_bg(this);">设为封面</a>';
					html+='<a href="javascript:void(0);" class="item-close" onclick="del_pic(this);"></a>';
					html+='<img src="' + path + '" alt="" width="100" height="75" />';
					html+='<input type="hidden" name="pic_short[]" class="pic_short" value="'+item+'">';
					html+='</div>';
				}
			});
			$("#uploadImgcontainer").append(html); 
		});
		return true;
	}
}

$(function() {
	$("._house_style").click(function() {
		$(this).siblings().removeClass('selected');
		$(this).addClass('selected');
		var key = $(this).attr('key')
		if(key == 1) {
			$("#sd_tr").show();
			$("#rent_tr").hide();
			$("#type_id").val(2);
			$("#rent_style_id").val("");
		} else {
			$("#sd_tr").hide();
			$("#rent_tr").show();
			$("#type_id").val(3);
			if(key == 2) {
				$("#rent_style_id").val(1);
			} else {
				$("#rent_style_id").val(2);
			}
		}
	});
	
	$('#description').xheditor({
		//upLinkUrl:"upload.php",
		//upLinkExt:"zip,rar,txt",
		upImgUrl:"/house/upload_pic",
		upImgExt:"jpg,jpeg,gif,png",
		upFlashExt:"swf",
		//upMediaUrl:"upload.php",
		tools:'Bold,Italic,Underline,Strikethrough,List,Link,Unlink,Img,Hr,Emot,Table,Source,Preview,Cut,Copy,Paste,Pastetext,Blocktag,Fullscreen',
		html5Upload:false,
		cleanPaste:2,
		height:'300'
	});

	$("#xiaoquSelect").combobox();
	
	$("#fileUpload").click(function() {
		var html = '<div id="uploader" style="width:750px;"><p>Your browser doesn\'t have Flash, Silverlight or HTML5 support.</p></div>';

		var layerIndex = layer.confirm(html, {
			offset: ['100px', (document.body.offsetWidth - 800) / 2],
			maxWidth: 800,
		    btn: ['确定','取消'], //按钮
		    shade: false //不显示遮罩
		}, function(){
			uploadFile();
			layer.close(layerIndex);
		    //layer.msg('的确很重要', { icon: 1 });
		}, function(){
		    //layer.msg('奇葩么么哒', { shift: 6 });
		});
		
		/*
		easyDialog.open({
			container : {
			    header : '上传图片',
			    content : html,
			    yesFn : function() {
			    	return uploadFile();
			    },
			    noFn : true
			  }
		});
		*/
		
		$("#uploader").plupload({
			runtimes : 'html5,flash,silverlight',
			url : "/house/save_pics/" + $("#folder").val(),
	        max_file_size : '50mb',
	        // Resize images on clientside if we can
	        resize : {
	            crop: true // crop to exact dimensions
	        },
	        file_data_name: 'userfile',
	        // Specify what files to browse for
	        filters : [],
	        filters: {
	        	mime_types : [{
	        		title : "Image files", extensions : "jpg,gif,png"
	        	}],
	        	max_file_size : '1024kb', //最大只能上传400kb的文件
	        	prevent_duplicates : true //不允许选取重复文件
	        },
	        // Rename files by clicking on their titles
	        rename: true,
	        // Sort files
	        sortable: true,
	        // Enable ability to drag'n'drop files onto the widget (currently only HTML5 supports that)
	        dragdrop: true,
	        // Views to activate
	        views: {
	            list: true,
	            thumbs: true, // Show thumbs
	            active: 'thumbs'
	        },
			// Flash settings
			flash_swf_url : '{{$base_url}}plupload/js/Moxie.swf',
			// Silverlight settings
			silverlight_xap_url : '{{$base_url}}plupload/js/Moxie.xap'
		});
	});
	
	$("#btnSubmit").click(function() {		
		var xiaoqu = $("#xiaoquSelect").val();
		if(xiaoqu == "") {
			FM_Alert('请选取小区');
			return;
		}
		
		var style_id = $("#style_id").val();
		var substyle_id = $("#substyle_id").val();
		if(style_id == "" || substyle_id == "") {
			FM_Alert('请选择房源类型');
			return;
		}
		
		var region_id = $("#region_id").val();
		if(region_id == "") {
			FM_Alert('请选择所在区域');
			return;
		}
		
		var room = $("#room").val();
		var lounge = $("#lounge").val();
		var toilet = $("#toilet").val();
		if(room == "" || lounge == "" || toilet == "") {
			FM_Alert('请选择户型信息(室厅卫)');
			return;
		}
		
		var floor = $("#floor").val();
		if(floor == "") {
			FM_Alert('请填写所在楼层');
			return;
		}
		
		if(!isInt(Math.abs(floor))) {
			FM_Alert('所在楼层格式不正确');
			return;
		}
		
		var total_floor = $("#total_floor").val();
		if(total_floor == "") {
			FM_Alert('请填写总楼层');
			return;
		}
		
		if(!isInt(total_floor)) {
			FM_Alert('总楼层格式不正确');
			return;
		}
		
		var acreage = $("#acreage").val();
		if(acreage == "") {
			FM_Alert('请填写面积');
			return;
		}
		
		if(!isFloat(acreage)) {
			FM_Alert('面积格式不正确');
			return;
		}
		
		var build_year = $("#build_year").val();
		if(build_year == "") {
			FM_Alert('请填写建造年代');
			return;
		}
		
		if(!isInt(build_year) || build_year.length != 4) {
			FM_Alert('建造年代格式不正确');
			return;
		}
		
		var orientation_id = $("#orientation_id").val();
		if(orientation_id == "") {
			FM_Alert('请选择朝向');
			return;
		}
		
		var type_id = $("#type_id").val();
		if(type_id == 2) {
			var total_price = $("#total_price").val();
			if(total_price == "") {
				FM_Alert('请填写期望售价');
				return;
			}
			
			if(!isFloat(total_price)) {
				FM_Alert('期望售价格式不正确');
				return;
			}
		} else {
			var unit_price = $("#unit_price").val();
			if(unit_price == "") {
				FM_Alert('请填写期望租金');
				return;
			}
			
			if(!isFloat(unit_price)) {
				FM_Alert('期望租金格式不正确');
				return;
			}
			
			var rent_type_id = $("#rent_type_id").val();
			if(rent_type_id == "") {
				FM_Alert('请填写租金押付');
				return;
			}
		}
		
		var estate_price = $("#estate_price").val();
		if(estate_price == "") {
			FM_Alert('请填写物业费');
			return;
		}
		
		if(!isFloat(estate_price)) {
			FM_Alert('物业费格式不正确');
			return;
		}
		
		var facility = $("#facility").val();
		if(facility == "") {
			FM_Alert('请填写配套设施');
			return;
		}
		
		var name = $("#name").val();
		if(name == "") {
			FM_Alert('请填写房源标题');
			return;
		}
		
		var sub_title = $("#sub_title").val();
		if(sub_title == "") {
			FM_Alert('请填写房源副标题');
			return;
		}
		
		var pic_length = $("#uploadImgcontainer").children(".w_upload").length;
		if(pic_length < 1) {
			FM_Alert('请上传房源图片');
			return;
		}
		
		var bg_pic = $("#is_bg").val();
		if(bg_pic == "") {
			FM_Alert("请设置房源图片封面");
			return false;
		}
		
		var description = $("#description").val();
		if(description == "") {
			FM_Alert('请填写房源描述');
			return;
		}
		
		var user_name = $("#user_name").val();
		if(user_name == "") {
			FM_Alert('请填写姓名');
			return;
		}
		
		var user_tel = $("#user_tel").val();
		if(user_tel == "") {
			FM_Alert('请填写联系电话');
			return;
		}
		
		{literal}
		if(!(/^1[3|4|5|8][0-9]\d{4,8}$/.test(user_tel))) {
			FM_Alert('联系电话格式不正确');
			return;
		}
		{/literal}
		
		layer.confirm("您确定要发布房源吗？", {
		    btn: ['确定','取消'] //按钮
		}, function(){
			$("#publishForm").submit();
		}, function(){
			//TODO
		});
	});
});

function del_pic(obj) {
	var current_pic = $(obj).parent().find('input[name="pic_short[]"]').val();
	$.getJSON("/house/del_pic/" + $("#folder").val() + "/" + current_pic + "/", function(data){
		if(data.flag == 1){
			$(obj).parent().remove();
		}else{
			alert("删除图片失败，请清理图片缓存并刷新标签页");
		}
	});
}

function set_bg(obj) {
	var current_pic = $(obj).parent().find('input[name="pic_short[]"]').val();
	var iscover = $(obj).parent().siblings().find('.iscover');
	iscover.parent().prepend('<a href="javascript:void(0);" class="set-cover" onclick="set_bg(this);">设为封面</a>');
	iscover.remove();
	$(obj).parent().prepend('<em class="iscover"></em>');
	$(obj).parent().find('.set-cover').remove();

	var pic = $("#folder").val() + '/1/' + current_pic;
	$("#is_bg").val(pic);
}

function FM_Alert(msg) {
	/*
	easyDialog.open({
	  	container : {
	    	header : '错误提示',
	    	content : msg
	  	},
	  	overlay : true,
	  	autoClose : 1500
	});
	*/
	layer.msg(msg, { icon: 2, time: 1500 });
}

function isInt(oNum){
	if(!oNum) return false;
	var strP=/^\d+$/;
	if(!strP.test(oNum)) return false;
	return true;
}

function isFloat(oNum) {
	if(!oNum) return false;
	var strP=/^\d+(\.\d+)?$/;
	if(!strP.test(oNum)) return false;
	try{
		if(parseFloat(oNum)!=oNum) return false;
	} catch(ex){
		return false;
	}
	return true;
}
</script>
</body>
</html>